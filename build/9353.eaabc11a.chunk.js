"use strict";(self.webpackChunkstrapi_cloudinary=self.webpackChunkstrapi_cloudinary||[]).push([[9353,8667],{69353:(ss,j,s)=>{s.d(j,{ProtectedCreatePage:()=>H});var e=s(74081),D=s(15530),g=s(24468),R=s(66947),W=s(78667),U=s(15816),B=s(97442),y=s(13576),T=s(87830),L=s(47184),O=s(364),K=s(27279),S=s(59461),b=s(40464),c=s(71563),Z=s(49204),x=s(47853),$=s(74919),es=s(29206),ts=s(98934),ns=s(43433),as=s(75719),z=s(8175),os=s(6078),rs=s(51943),f=s(55783),p=s(92249),is=s(41942),V=s(22919),X=s(53915),Q=s(75041),ds=s(30200),ls=s(91379),_s=s(33299),G=s(33409),Es=s(63645),Y=s(7988),cs=s(7055),gs=s(26757),m=s(58311),I=s(29510),C=s(16946),hs=s(10124),k=s(69530),Ms=s(86961),J=s(51527),Ps=s(19764),Os=s(42982),Ds=s(26126),us=s(64797),ms=s(85811),vs=s(59491);const H=()=>{const w=(0,g.f)(R.s);return(0,e.jsx)(D.O4,{permissions:w.settings?.webhooks.create,children:(0,e.jsx)(W.E,{})})}},78667:(ss,j,s)=>{s.r(j),s.d(j,{E:()=>q,a:()=>N,b:()=>Bs});var e=s(74081),D=s(27279),g=s(10701),R=s(2878),W=s(77970),U=s(96226),B=s(25191),y=s(4540),T=s(51094),L=s(10989),O=s(32370),K=s(67472),S=s(22572),b=s(73411),c=s(93415),Z=s(23298),x=s(74577),$=s(12881),es=s(1782),ts=s(8295),ns=s(61121),as=s(27875),z=s(48102),os=s(74758),rs=s(73354),f=s(15530),p=s(40464),is=s(47533),V=s(51447),X=s(24468),Q=s(59491),ds=s(66947),ls=s(79213),_s=s(36938),G=s(95066),Es=s(34547),Y=s(59082),cs=s(64820),gs=s(76827),m=s(71563),I=s(61020),C=s(47853),hs=s(76873),k=s(19003);const[Ms,J]=(0,hs.k)("WebhookEvent"),Ps=({children:t})=>{const{formatMessage:n}=(0,I.Z)(),{collectionTypes:a,isLoading:_}=(0,Q.u)(),o=D.useMemo(()=>a.some(r=>r.options?.draftAndPublish===!0),[a]),l=n({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,e.jsx)(Ms,{isDraftAndPublish:o,children:(0,e.jsxs)(g.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(R.Q,{"aria-hidden":!0,children:l}),_&&(0,e.jsx)(W.a,{children:n({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,e.jsx)(Os,{"aria-label":l,children:t})]})})},Os=(0,k.default)(U.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:t})=>t.colors.neutral100};
  }

  thead th span {
    color: ${({theme:t})=>t.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:t})=>t.spaces[3]};
    padding-block-end: ${({theme:t})=>t.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:t})=>t.spaces[2]};
  }
`,Ds=t=>{const n=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return t&&(n.push({id:"app.utils.publish",defaultMessage:"Publish"}),n.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),n},us=({getHeaders:t=Ds})=>{const{isDraftAndPublish:n}=J("Headers"),{formatMessage:a}=(0,I.Z)(),_=t(n);return(0,e.jsx)(B.S,{children:(0,e.jsxs)(y.Z,{children:[(0,e.jsx)(T.g,{children:(0,e.jsx)(L.T,{children:a({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),_.map(o=>["app.utils.publish","app.utils.unpublish"].includes(o?.id??"")?(0,e.jsx)(T.g,{title:a({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,e.jsx)(O.Z,{variant:"sigma",textColor:"neutral600",children:a(o)})},o.id):(0,e.jsx)(T.g,{children:(0,e.jsx)(O.Z,{variant:"sigma",textColor:"neutral600",children:a(o)})},o.id))]})})},ms=({providedEvents:t})=>{const{isDraftAndPublish:n}=J("Body"),a=t||vs(n),{values:_,handleChange:o}=(0,m.u6)(),l="events",r=_.events,P=[],u=r.reduce((d,i)=>{const h=i.split(".")[0];return d[h]||(d[h]=[]),d[h].push(i),d},{}),E=({target:{name:d,value:i}})=>{const h=new Set(r);i?h.add(d):h.delete(d),o({target:{name:l,value:Array.from(h)}})},v=({target:{name:d,value:i}})=>{const h=new Set(r);i?a[d].forEach(A=>{P.includes(A)||h.add(A)}):a[d].forEach(A=>h.delete(A)),o({target:{name:l,value:Array.from(h)}})};return(0,e.jsx)(K.X,{children:Object.entries(a).map(([d,i])=>(0,e.jsx)(H,{disabledEvents:P,name:d,events:i,inputValue:u[d],handleSelect:E,handleSelectAll:v},d))})},vs=t=>{const n=["entry.create","entry.update","entry.delete"];return t&&n.push("entry.publish","entry.unpublish"),{entry:n,media:["media.create","media.update","media.delete"]}},H=({disabledEvents:t=[],name:n,events:a=[],inputValue:_=[],handleSelect:o,handleSelectAll:l})=>{const{formatMessage:r}=(0,I.Z)(),P=a.filter(i=>!t.includes(i)),u=_.length>0,E=_.length===P.length,v=({target:{name:i}})=>{l({target:{name:i,value:!E}})},d=5;return(0,e.jsxs)(y.Z,{children:[(0,e.jsx)(T.f,{children:(0,e.jsx)(S.X,{indeterminate:u&&!E,"aria-label":r({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:n,onChange:v,value:E,children:w(n)})}),a.map(i=>(0,e.jsx)(T.f,{children:(0,e.jsx)(b.C,{disabled:t.includes(i),"aria-label":i,name:i,value:_.includes(i),onValueChange:h=>o({target:{name:i,value:h}})})},i)),a.length<d&&(0,e.jsx)(T.f,{colSpan:d-a.length})]})},w=t=>t.replace(/-/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "),N={Root:Ps,Headers:us,Body:ms,Row:H},As=()=>(0,e.jsxs)(N.Root,{children:[(0,e.jsx)(N.Headers,{}),(0,e.jsx)(N.Body,{})]}),Ts=()=>{const{formatMessage:t}=(0,I.Z)(),{values:n,errors:a}=(0,m.u6)();return(0,e.jsxs)(g.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(R.Q,{children:t({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,e.jsx)(c.x,{padding:8,background:"neutral100",hasRadius:!0,children:(0,e.jsx)(m.F2,{validateOnChange:!1,name:"headers",render:({push:_,remove:o})=>(0,e.jsxs)(Z.r,{gap:4,children:[n.headers.map((l,r)=>{const P=a.headers?.[r],u=typeof P=="object"?P.key:void 0,E=typeof P=="object"?P.value:void 0;return(0,e.jsxs)(D.Fragment,{children:[(0,e.jsx)(x.P,{col:6,children:(0,e.jsx)(m.gN,{as:xs,name:`headers.${r}.key`,"aria-label":`row ${r+1} key`,label:t({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:u})}),(0,e.jsx)(x.P,{col:6,children:(0,e.jsxs)(g.k,{alignItems:"flex-end",children:[(0,e.jsx)(c.x,{style:{flex:1},children:(0,e.jsx)(m.gN,{as:$.o,name:`headers.${r}.value`,"aria-label":`row ${r+1} value`,label:t({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:E})}),(0,e.jsx)(g.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:E?0:5,children:(0,e.jsx)(f.fG,{disabled:n.headers.length===1,onClick:()=>o(r),label:t({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:r+1})})})]})})]},`${r}.${l.key}`)}),(0,e.jsx)(x.P,{col:12,children:(0,e.jsx)(es.A,{type:"button",onClick:()=>{_({key:"",value:""})},startIcon:(0,e.jsx)(_s.Z,{}),children:t({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},xs=({name:t,onChange:n,value:a,..._})=>{const{values:{headers:o}}=(0,m.u6)(),[l,r]=D.useState([...fs]);D.useEffect(()=>{const E=fs.filter(v=>!o?.some(d=>d.key!==a&&d.key===v));r(E)},[o,a]);const P=E=>{n({target:{name:t,value:E}})},u=E=>{r(v=>[...v,E]),P(E)};return(0,e.jsx)(ts.XU,{..._,onClear:()=>P(""),onChange:P,onCreateOption:u,placeholder:"",value:a,children:l.map(E=>(0,e.jsx)(ns.O,{value:E,children:E},E))})},fs=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],Is=({isPending:t,onCancel:n,response:a})=>{const{statusCode:_,message:o}=a??{},{formatMessage:l}=(0,I.Z)();return(0,e.jsx)(c.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(Z.r,{gap:4,style:{alignItems:"center"},children:[(0,e.jsx)(x.P,{col:3,children:(0,e.jsx)(O.Z,{children:l({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,e.jsx)(x.P,{col:3,children:(0,e.jsx)(js,{isPending:t,statusCode:_})}),(0,e.jsx)(x.P,{col:6,children:t?(0,e.jsx)(g.k,{justifyContent:"flex-end",children:(0,e.jsx)("button",{onClick:n,type:"button",children:(0,e.jsxs)(g.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(O.Z,{textColor:"neutral400",children:l({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,e.jsx)(F,{as:G.Z,color:"neutral400"})]})})}):(0,e.jsx)(Rs,{statusCode:_,message:o})})]})})},F=k.default.svg(({theme:t,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;


  ${n?(0,k.css)`
          path {
            fill: ${t.colors[n]};
          }
        `:""}
`),js=({isPending:t,statusCode:n})=>{const{formatMessage:a}=(0,I.Z)();return t||!n?(0,e.jsxs)(g.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(F,{as:Es.Z}),(0,e.jsx)(O.Z,{children:a({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):n>=200&&n<300?(0,e.jsxs)(g.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(F,{as:Y.Z,color:"success700"}),(0,e.jsx)(O.Z,{children:a({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):n>=300?(0,e.jsxs)(g.k,{gap:2,alignItems:"center",children:[(0,e.jsx)(F,{as:G.Z,color:"danger700"}),(0,e.jsxs)(O.Z,{children:[a({id:"Settings.error",defaultMessage:"error"})," ",n]})]}):null},Rs=({statusCode:t,message:n})=>{const{formatMessage:a}=(0,I.Z)();return t?t>=200&&t<300?(0,e.jsx)(g.k,{justifyContent:"flex-end",children:(0,e.jsx)(O.Z,{textColor:"neutral600",ellipsis:!0,children:a({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):t>=300?(0,e.jsx)(g.k,{justifyContent:"flex-end",children:(0,e.jsx)(g.k,{maxWidth:(0,f.Q1)(250),justifyContent:"flex-end",title:n,children:(0,e.jsx)(O.Z,{ellipsis:!0,textColor:"neutral600",children:n})})}):null:null},ys=({handleSubmit:t,triggerWebhook:n,isCreating:a,isTriggering:_,triggerResponse:o,data:l})=>{const{formatMessage:r}=(0,I.Z)(),[P,u]=D.useState(!1),E=(0,X.j)(As,async()=>(await s.e(1601).then(s.bind(s,11601))).EventsTableEE),v=i=>Object.keys(i).length?Object.entries(i).map(([h,A])=>({key:h,value:A})):[{key:"",value:""}],d=(0,m.TA)({initialValues:{name:l?.name||"",url:l?.url||"",headers:v(l?.headers||{}),events:l?.events||[]},onSubmit(i,{resetForm:h,setSubmitting:A}){t(i),h({values:i}),A(!1)},validationSchema:Us({formatMessage:r}),validateOnChange:!1,validateOnBlur:!1});return E?(0,e.jsx)(m.Hy,{value:d,children:(0,e.jsxs)(f.l0,{children:[(0,e.jsx)(as.T,{primaryAction:(0,e.jsxs)(g.k,{gap:2,children:[(0,e.jsx)(z.z,{onClick:()=>{n(),u(!0)},variant:"tertiary",startIcon:(0,e.jsx)(cs.Z,{}),disabled:a||_,size:"L",children:r({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,e.jsx)(z.z,{startIcon:(0,e.jsx)(Y.Z,{}),type:"submit",size:"L",disabled:!d.dirty,loading:d.isSubmitting,children:r({id:"global.save",defaultMessage:"Save"})})]}),title:a?r({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):l?.name,navigationAction:(0,e.jsx)(ls.r,{as:is.OL,startIcon:(0,e.jsx)(gs.Z,{}),to:"/settings/webhooks",children:r({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(os.D,{children:(0,e.jsxs)(g.k,{direction:"column",alignItems:"stretch",gap:4,children:[P&&(0,e.jsx)(Is,{isPending:_,response:o,onCancel:()=>u(!1)}),(0,e.jsx)(c.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(g.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(Z.r,{gap:6,children:[(0,e.jsx)(x.P,{col:6,children:(0,e.jsx)(m.gN,{as:$.o,name:"name",error:d.errors.name,label:r({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,e.jsx)(x.P,{col:12,children:(0,e.jsx)(m.gN,{as:$.o,name:"url",error:d.errors.url,label:r({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,e.jsx)(Ts,{}),(0,e.jsx)(E,{})]})})]})})]})}):null},Ls=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ws=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Us=({formatMessage:t})=>C.Ry().shape({name:C.Z_().required(t({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(Ls,t({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:C.Z_().required(t({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ws,t({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:C.Vo(n=>{const a=C.IX();if(n.length===1){const{key:_,value:o}=n[0];if(!_&&!o)return a}return a.of(C.Ry().shape({key:C.Z_().required(t({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:C.Z_().required(t({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:C.IX()}),Cs=t=>({...t,headers:t.headers.reduce((n,{key:a,value:_})=>(a!==""&&(n[a]=_),n),{})}),q=()=>{const n=(0,V.$B)("/settings/webhooks/:id")?.params.id,a=n==="create",{replace:_}=(0,V.k6)(),o=(0,f.lm)(),{formatAPIError:l}=(0,f.So)(),{isLoading:r}=(0,Q.u)(),{put:P,get:u,post:E}=(0,f.kY)(),{isLoading:v,data:d,error:i,refetch:h}=(0,p.useQuery)(["webhooks",n],async()=>{const{data:{data:M}}=await u(`/admin/webhooks/${n}`);return M},{enabled:!a});D.useEffect(()=>{i&&o({type:"warning",message:l(i)})},[i,o,l]);const{isLoading:A,data:ps,mutate:Ks}=(0,p.useMutation)(()=>E(`/admin/webhooks/${n}/trigger`).then(M=>M.data.data),{onError(M){o({type:"warning",message:l(M)})}}),Ss=(0,p.useMutation)(M=>E("/admin/webhooks",M),{onSuccess({data:M}){o({type:"success",message:{id:"Settings.webhooks.created"}}),_(`/settings/webhooks/${M.data.id}`)},onError(M){o({type:"warning",message:l(M)})}}),bs=(0,p.useMutation)(({id:M,body:$s})=>P(`/admin/webhooks/${M}`,$s),{onSuccess(){h(),o({type:"success",message:{id:"notification.form.success.fields"}})},onError(M){o({type:"warning",message:l(M)})}}),Zs=async M=>{if(a){Ss.mutate(Cs(M));return}bs.mutate({id:n,body:Cs(M)})};return v||r?(0,e.jsx)(f.dO,{}):(0,e.jsxs)(rs.o,{children:[(0,e.jsx)(f.SL,{name:"Webhooks"}),(0,e.jsx)(ys,{data:d,handleSubmit:Zs,triggerWebhook:Ks,isCreating:a,isTriggering:A,triggerResponse:ps})]})},Bs=Object.freeze(Object.defineProperty({__proto__:null,EditPage:q,ProtectedEditPage:()=>{const t=(0,X.f)(ds.s);return(0,e.jsx)(f.O4,{permissions:t.settings?.webhooks.update,children:(0,e.jsx)(q,{})})}},Symbol.toStringTag,{value:"Module"}))},59491:(ss,j,s)=>{s.d(j,{u:()=>W});var e=s(27279),D=s(15530),g=s(53532),R=s(40464);function W(){const{get:U}=(0,D.kY)(),{formatAPIError:B}=(0,D.So)(),y=(0,D.lm)(),T=(0,R.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:c}}=await U("/content-manager/components");return c},onError(c){c instanceof g.d7&&y({type:"warning",message:B(c)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:c}}=await U("/content-manager/content-types");return c},onError(c){c instanceof g.d7&&y({type:"warning",message:B(c)})}}]),[L,O]=T,K=L.isLoading||O.isLoading,S=e.useMemo(()=>(O?.data??[]).filter(c=>c.kind==="collectionType"&&c.isDisplayed),[O?.data]),b=e.useMemo(()=>(O?.data??[]).filter(c=>c.kind!=="collectionType"&&c.isDisplayed),[O?.data]);return{isLoading:K,components:e.useMemo(()=>L?.data??[],[L?.data]),collectionTypes:S,singleTypes:b}}}}]);
